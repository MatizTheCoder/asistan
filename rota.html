<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rota √úzerindeki Hava Durumu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <script>
    (function () {
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark");
      }
    })();
  </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans">

  <main class="max-w-md mx-auto p-4 space-y-6">
    <h1 class="text-xl font-bold mb-4">üó∫Ô∏è Rota Olu≈ütur & Hava Durumunu G√∂r</h1>

    <form id="route-form" class="space-y-4">
      <input type="text" id="from-city" placeholder="Nereden?" required class="w-full p-2 border rounded text-black">
      <input type="text" id="to-city" placeholder="Nereye?" required class="w-full p-2 border rounded text-black">
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Rota Olu≈ütur</button>
    </form>

    <div id="weather-results" class="space-y-4 mt-6"></div>
  </main>

  <script>
    const form = document.getElementById('route-form');
    const resultDiv = document.getElementById('weather-results');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultDiv.innerHTML = 'Y√ºkleniyor...';

      const from = document.getElementById('from-city').value;
      const to = document.getElementById('to-city').value;

      try {
        const coordFrom = await getCoords(from);
        const coordTo = await getCoords(to);

        const midpoint = {
          lat: (coordFrom.lat + coordTo.lat) / 2,
          lon: (coordFrom.lon + coordTo.lon) / 2,
        };

        const weather = await getWeather(midpoint.lat, midpoint.lon);

        resultDiv.innerHTML = `
          <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded shadow">
            <h2 class="text-lg font-bold mb-2">${from} ‚û°Ô∏è ${to}</h2>
            <p>Sƒ±caklƒ±k: ${weather.temperature}¬∞C</p>
            <p>Durum: ${weather.condition}</p>
            <p>R√ºzgar: ${weather.wind} km/h</p>
          </div>
        `;
      } catch (err) {
        resultDiv.innerHTML = '<p class="text-red-500">Bir hata olu≈ütu.</p>';
        console.error(err);
      }
    });

    async function getCoords(city) {
      const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
      const data = await res.json();
      if (!data[0]) throw new Error('Konum bulunamadƒ±');
      return {
        lat: parseFloat(data[0].lat),
        lon: parseFloat(data[0].lon)
      };
    }

    async function getWeather(lat, lon) {
      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
      const data = await res.json();
      return {
        temperature: data.current_weather.temperature,
        wind: data.current_weather.windspeed,
        condition: weatherCodeToText(data.current_weather.weathercode)
      };
    }

    function weatherCodeToText(code) {
      const map = {
        0: "G√ºne≈üli", 1: "Az Bulutlu", 2: "Par√ßalƒ± Bulutlu", 3: "Kapalƒ±",
        45: "Sisli", 51: "√áiseleme", 61: "Yaƒümurlu", 71: "Kar", 80: "Saƒüanak"
      };
      return map[code] || "Bilinmiyor";
    }
  </script>

</body>
</html>
